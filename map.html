<!DOCTYPE HTML>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <title>Hanviken SK friidrott</title>
  <link rel="icon" href="http://hanviken.niklassons.net/favicon.jpg" type="image/jpg" />
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDo0DbHrfNufjlT0En0v91B8mbyjiFXxP8&callback=initMap" type="text/javascript"></script>
  <script type="text/javascript">

  google.load('visualization', '1', { packages : [ 'corechart', 'map', 'table' ] });
  google.charts.setOnLoadCallback(initiateData);

  var docList = ["1kgJxJ8skKZ5bGXEiIht3FTnTVRjAFPvlitZEFEK-Eto", // Utomhus 2016
                ];
  var data;
  var dataList = [];
  var view;
  var filterList = [];
  var table;
  
  function initMap() {
      // Do nothing...
  }
  
  function initiateData() {
    var queryString = encodeURIComponent('SELECT *');
    for (i = 0; i < docList.length; i++) { 
        var queryUrl = "https://docs.google.com/spreadsheets/d/" + docList[i] + "/gviz/tq?headers=1&tq=" + queryString;
        var query = new google.visualization.Query(queryUrl);
        query.send(handleQueryResponse);
        console.log(docList[i]);
    }
  }

  function handleQueryResponse(response) {
    if (response.isError()) {
      alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
      return;
    }
    dataList.push(response.getDataTable());
    finished();
  }

  function finished() {
    if (dataList.length != docList.length) {
        //do nothing if data tables are not fully ready
        return;
    }
    var json = JSON.parse(dataList[0].toJSON());
    for (i = 1; i < dataList.length; i++) { 
        var json2 = JSON.parse(dataList[i].toJSON());
        var mergedRows = json.rows.concat(json2.rows);
        json.rows = mergedRows;
    }
    data = new google.visualization.DataTable(json);
    console.log(json);

    // displayChart();
    displayMap();
  }

  function displayMap() {
    var geoData = google.visualization.arrayToDataTable([
          ['Lat', 'Lon', 'Name'],
          [59.2898365, 17.9276445, 'Brommaspelen - Sätra IP, Sätra'],
          [57.7059158,11.9870548, 'Världsungdomsspelen - Ullevi, Göteborg'],
          [59.2255016,18.2197373, 'Tyresö ungdoms- och veteranspel - Trollbäckens IP, Tyresö'],
          [59.620632, 17.8368365, 'Midgårdskastet - Midgårdsvallen, Märsta'],
          ]);

    var formatter = new google.visualization.NumberFormat({fractionDigits: 7});
    formatter.format(geoData, 0);
    formatter.format(geoData, 1);

    var options = {
      showTooltip: true,
      showInfoWindow: true,
      enableScrollWheel: true,
      mapTypeControl: true,
    };

    var map = new google.visualization.Map(document.getElementById('map_div'));
    map.draw(geoData, options);
    
    table = new google.visualization.Table(document.getElementById('table_div'));
    table.draw(geoData, {showRowNumber: true, width: '1000', height: '100%'});
    
    // Set a 'select' event listener for the table.
    // When the table is selected, we set the selection on the map.
    google.visualization.events.addListener(table, 'select',
        function() {
          map.setSelection(table.getSelection());
        });

    // Set a 'select' event listener for the map.
    // When the map is selected, we set the selection on the table.
    google.visualization.events.addListener(map, 'select',
        function() {
          table.setSelection(map.getSelection());
        });
  }
  
  </script>
</head>

<html>
  <body>
    <!--header class="w3-container w3-round w3-light-grey w3-margin">
      <h3>Hanviken SK Friidrott</h3>
    </header-->
      <ul class="w3-navbar w3-round w3-light-grey w3-medium w3-margin">
        <li><a href="index.html"><i class="fa fa-table"></i> Resultat</a></li>
        <li class="w3-dropdown-hover">
          <a href="#"><i class="fa fa-bar-chart"></i> Statistik <i class="fa fa-caret-down"></i></a>
          <div class="w3-dropdown-content w3-white w3-card-4">
            <a href="stats.html"><i class="fa fa-pie-chart"></i> Antal starter per klass</a>
            <a href="#">Link 2</a>
            <a href="#">Link 3</a>
          </div>
        </li>    
        <li><a class="w3-green" href="map.html"><i class="fa fa-map-marker"></i> Karta</a></li>
        <li class="w3-dropdown-hover">
          <a href="#"><i class="fa fa-link"></i> Länkar <i class="fa fa-caret-down"></i></a>
          <div class="w3-dropdown-content w3-white w3-card-4">
            <a href="https://hanvikenssk.myclub.se/friidrott" target="_blank">Hanviken SK friidrott</a>
            <a href="http://friidrott.se" target="_blank">Friidrott.se</a>
          </div>
        </li>
      </ul>
    <header class="w3-container w3-round w3-light-grey w3-margin">
      <h3>Hanviken SK Friidrott - Tävlingar utomhus 2016</h3>
    </header>
    <div class="w3-container w3-round w3-light-grey w3-margin">
      <p></p>
      <div id="map_div" style="width: 900px; height: 500px;"></div>
      <p></p>
      <div id="table_div"></div>
      <p></p>
    </div>
  </body>
</html>
