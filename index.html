<!DOCTYPE HTML>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <title>Hanviken friidrott - Resultat</title>
  <link rel="icon" href="images/favicon.jpg" type="image/jpg" />
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="includes/athletics-stats.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  
  <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
  <script type="text/javascript">

  var docs = 'all';
  var docList;    
  var data;
  var dataList = [];
  var view;
  var filterList = [];
  var table;
  var bookmarkUrl;
  
  google.load('visualization', '1', { packages : [ 'corechart', 'table' ] });
  google.charts.setOnLoadCallback(initiateData);
  //google.charts.setOnLoadCallback(getJsonData);

  function finished() {
    data.sort([{column: 11, desc: true},{column: 1}]);
    filterData();
  }

  function filterData() {
    view = new google.visualization.DataView(data);
    table = new google.visualization.Table(document.getElementById('table_div'));
    
    filterList = [];
    bookmarkUrl = window.location.href.split("?")[0];
    
    // Filter on events in column '0'
    var eventNo = eventForm.eventList.selectedIndex;
    if (eventNo) {
        filterList.push({column:0, value:eventForm.eventList.options[eventNo].text});
        bookmarkUrl = updateUrl(bookmarkUrl,'event',eventForm.eventList.options[eventNo].text);
    }
    
    // Filter on names in column 1
    var nameNo = nameForm.nameList.selectedIndex;
    if (nameNo) {
       filterList.push({column:1, value:nameForm.nameList.options[nameNo].text});
       bookmarkUrl = updateUrl(bookmarkUrl,'name',nameForm.nameList.options[nameNo].text);
    }
    // Filter on birth year in column 2
    var yearNo = yearForm.yearList.selectedIndex;
    if (yearNo) {
       filterList.push({column:2, value:yearForm.yearList.options[yearNo].text});
       bookmarkUrl = updateUrl(bookmarkUrl,'year',yearForm.yearList.options[yearNo].text);
    }
    
    // Filter on class in column 8
    var classNo = classForm.classList.selectedIndex;
    if (classNo) {
        filterList.push({column:8, value:classForm.classList.options[classNo].text});
        bookmarkUrl = updateUrl(bookmarkUrl,'class',classForm.classList.options[classNo].text);
    }
    
    // Filter on competition in column 10
    var competitionNo = competitionForm.competitionList.selectedIndex;
    if (competitionNo) {
        filterList.push({column:10, value:competitionForm.competitionList.options[competitionNo].text});
        bookmarkUrl = updateUrl(bookmarkUrl,'competition',competitionForm.competitionList.options[competitionNo].text);
    }    

    // Filter on season in column 12
    var seasonNo = seasonForm.seasonList.selectedIndex;
    if (seasonNo) {
        filterList.push({column:12, value:seasonForm.seasonList.options[seasonNo].text});
        bookmarkUrl = updateUrl(bookmarkUrl,'season',seasonForm.seasonList.options[seasonNo].text);
    }    

    // Apply the filter, and draw the table
    if(filterList.length > 0){
      view.setRows(view.getFilteredRows(filterList));
      console.log(bookmarkUrl);
    }
    document.getElementById('bookmarkUrl').innerHTML = '<a href="' + bookmarkUrl + '">' + bookmarkUrl + '</a>';
    table.draw(view, {showRowNumber: true, width: '1800', height: '100%'});
    populateSelections();
  }
  
  function populateSelections() {
    populateEventSelections();
    populateNameSelections();
    populateYearSelections();
    populateClassSelections();
    populateCompetitionSelections();
    populateSeasonSelections();
  }
  
  </script>
</head>

<html>
  <body onload="menu('1')">
    <div id="menu"></div> 
<div class="w3-container w3-round-large w3-light-grey w3-margin">
<p></p>
<table width="90%" align="center">
  <tr>
    <td><b>Säsong:</b></td>
    <td>
      <form name="seasonForm">
        <select id="seasonList" name="seasonList" title="Filtrera på Säsong" onChange="filterData()">
          <option>- Alla säsonger -
        </select>
      </form>
    </td>
    <td><b>Tävling:</b></td>
    <td>
      <form name="competitionForm">
        <select id="competitionList" name="competitionList" onChange="filterData()">
          <option>- Alla tävlingar -
        </select>
      </form>
    </td>
    <td><b>Gren:</b></td>
    <td>
      <form name="eventForm">
        <select id="eventList" name="eventList" onChange="filterData()">
            <option>- Alla grenar -
        </select>
      </form>
    </td>
    <td rowspan="2"><button class="w3-right w3-btn w3-white w3-border w3-border-green w3-round-xlarge" onClick="clearFilter()">Rensa alla filter</button></td>
  </tr>
  <tr>
    <td><b>Namn:</b></td>
    <td>
      <form name="nameForm">
        <select id="nameList" name="nameList" onChange="filterData()">
          <option>- Alla namn -
        </select>
      </form>
    </td>
    <td><b>Född:</b></td>
    <td>
      <form name="yearForm">
        <select id="yearList" name="yearList" onChange="filterData()">
          <option>- Alla födelseår -
        </select>
      </form>
    </td>
    <td><b>Klass:</b></td>
    <td>
      <form name="classForm">
        <select id="classList" name="classList" onChange="filterData()">
          <option>- Alla klasser -
        </select>
      </form>
    </td>
    
</tr>
</table>
<p></p>
<div id="bookmarkUrl" class="w3-tiny w3-right-align"></div>
<div id="table_div" class="w3-center"><p><i class="fa fa-spinner w3-spin" style="font-size:64px"></i></p></div>
<p></p>
</div>
</body>
</html>
